/* empty css                       */import{s as X,a as Y}from"./realtime.FYg-mwH9.js";import{g as Z}from"./supabase.CYCWDCT1.js";import{s as c,b as N,a as w,c as _}from"./toast.nt_L5FyR.js";import{f as g,A as ee,G as P}from"./ActionButton.wnuKMHr3.js";import{s as te,b as ne,d as R,f as se,u as oe,e as re,r as ie}from"./huntItemService.Itrye26R.js";/* empty css                           */import{_ as F}from"./_plugin-vue_export-helper.DzgpqwbF.js";import{d as k,c as y,o as p,a as d,k as H,t as C,n as M,m as q,F as j,r as O,f as x,g as ae,i as G,j as z}from"./runtime-core.esm-bundler.6V7JjrVJ.js";import"./runtime-dom.esm-bundler.DkFgPflE.js";const ue=k({__name:"HuntListItemSimple",props:{huntItem:{type:Object,required:!0}},emits:["remove"],setup(m,{expose:l,emit:t}){l();const s=m,h=t,u=q(()=>g(s.huntItem.item)),r={props:s,emit:h,formattedItemName:u,GameThumbnail:P,ActionButton:ee};return Object.defineProperty(r,"__isScriptSetup",{enumerable:!1,value:!0}),r}}),le={class:"flex items-center justify-between"},de={class:"flex items-center gap-2"},ce={class:"text-gold"};function me(m,l,t,s,h,u){return p(),y("div",{class:M(["p-3 border rounded-lg hover:bg-orange-900/40",t.huntItem.active?"bg-green-900/30 item-active":"bg-gray-800/40 item-inactive"])},[d("div",le,[d("div",de,[H(s.GameThumbnail,{"thumbnail-url":t.huntItem.custom_thumb,alt:t.huntItem.item,size:"xs"},null,8,["thumbnail-url","alt"]),d("span",ce,C(s.formattedItemName),1)]),H(s.ActionButton,{onClick:l[0]||(l[0]=r=>m.$emit("remove",t.huntItem.id)),variant:"danger",size:"xs",text:"Remove"})])],2)}const ge=F(ue,[["render",me],["__scopeId","data-v-19448714"]]),he=k({__name:"SuggestionItem",props:{suggestion:{type:Object,required:!0},recentlyAdded:{type:Boolean,default:!1}},emits:["add-to-hunt","image-error"],setup(m,{expose:l,emit:t}){l();const s=m,h=t,u=q(()=>g(s.suggestion.item));function r(I){h("image-error",{suggestionId:s.suggestion.id,type:I})}const v={props:s,emit:h,formattedItemName:u,handleImageError:r,GameThumbnail:P};return Object.defineProperty(v,"__isScriptSetup",{enumerable:!1,value:!0}),v}}),fe={class:"p-4 flex flex-col items-center text-center"},ve={class:"flex justify-between items-start w-full mt-3"},pe={class:"font-medium text-gold"},be={class:"text-xs px-2 py-1 bg-blue-100/20 text-blue-300 rounded-full"};function _e(m,l,t,s,h,u){return p(),y("div",{class:M(["border rounded-lg hover:bg-orange-900/40 cursor-pointer transition-all hover:shadow-md",{"bg-green-100/20":t.recentlyAdded}]),onClick:l[0]||(l[0]=r=>m.$emit("add-to-hunt",t.suggestion))},[d("div",fe,[H(s.GameThumbnail,{"thumbnail-url":t.suggestion.custom_thumb||t.suggestion.url_thumb,alt:t.suggestion.item,size:"lg","show-gradient":"",onImageError:s.handleImageError},null,8,["thumbnail-url","alt"]),d("div",ve,[d("span",pe,C(s.formattedItemName),1),d("span",be," x"+C(t.suggestion.count),1)])])],2)}const Ie=F(he,[["render",_e]]),we=!0,xe=k({__name:"SuggestionsList",props:{eventId:{},userId:{}},setup(m,{expose:l}){l();function t(...e){console.log("[SuggestionsList]",...e)}t("Component script initialization");const s=m;t("Props received:",s);const h=Z(),u=x([]),r=x([]),v=x([]),I=x(!1),S=x(!1),V=async(e,o,n=null)=>{try{const{success:i,error:a}=await te(e,o,n);return a?(console.error("Error saving custom thumbnail:",a),!1):i}catch(i){return console.error("Exception during saving custom thumbnail:",i),!1}},E=async()=>{try{t("Fetching suggestions for event:",s.eventId);const{suggestions:e,error:o}=await ne(s.eventId);if(o){console.error("Error fetching suggestions:",o),c(`Failed to load suggestions: ${o.message}`);return}try{const n="/bognushunter",{updatedSuggestions:i,error:a}=await R(e,n);a?(console.error("Error fetching game data for suggestions:",a),N("Some game thumbnails could not be loaded. Using placeholders instead.")):u.value=i}catch(n){console.error("Error fetching game data for suggestions:",n),N("Some game thumbnails could not be loaded. Using placeholders instead."),u.value=e}u.value.sort((n,i)=>i.count-n.count),t("Suggestions processed:",u.value.length),console.log(u),S.value||(S.value=!0,u.value.length>0?w(`Loaded ${u.value.length} suggestions`):_("No suggestions found for this hunt yet."))}catch(e){console.error("Exception during suggestions fetching:",e),c(`Failed to load suggestions: ${e instanceof Error?e.message:"Unknown error"}`)}},b=async()=>{try{t("Fetching hunt list for event:",s.eventId);const{huntItems:e,error:o}=await se(s.eventId);if(o){console.error("Error fetching hunt items:",o),c(`Failed to load hunt list: ${o.message}`);return}r.value=e,t("Hunt list fetched:",r.value.length),I.value||(I.value=!0,r.value.length>0?w(`Hunt list loaded with ${r.value.length} items`):_("Hunt list is empty. Add items by clicking on suggestions."))}catch(e){console.error("Exception during hunt list fetching:",e),c(`Failed to load hunt list: ${e instanceof Error?e.message:"Unknown error"}`)}},W=async e=>{try{const o=e.wager!==null&&e.result!==null&&(e.bonus||e.super_bonus),n={id:e.id,event_id:e.event_id,suggestion_id:e.suggestion_id,wager:e.wager,result:e.result,bonus:e.bonus,super_bonus:e.super_bonus,completed:o,active:e.active,custom_thumb:e.custom_thumb,url_background:e.url_background,item:e.item},{huntItem:i,error:a}=await oe(n);if(a){console.error("Error updating hunt item:",a),c(`Failed to update hunt item: ${a.message}`);return}if(!i){console.error("Failed to update hunt item"),c("Failed to update hunt item: Unknown error");return}t("Hunt item updated:",e.id),w("Hunt item updated successfully")}catch(o){console.error("Exception during hunt item update:",o),c(`Failed to update hunt item: ${o instanceof Error?o.message:"Unknown error"}`)}},J=async e=>{try{if(t("Adding suggestion to hunt list:",e),r.value.find(f=>f.item===e.item)){t("Item already exists in hunt list"),_(`"${g(e.item)}" is already in the hunt list`);return}_(`Adding "${g(e.item)}" to hunt list...`);const{huntItem:n,error:i,exists:a}=await re(s.eventId,e);if(a){t("Item already exists in hunt list:",e.item),_(`"${g(e.item)}" is already in the hunt list.`);return}if(i){console.error("Error adding suggestion to hunt list:",i),c(`Failed to add "${g(e.item)}" to hunt list: ${i.message}`);return}await b(),t("Suggestion added to hunt list:",e.item),w(`"${g(e.item)}" added to hunt list!`)}catch(o){console.error("Exception during adding suggestion to hunt list:",o),c(`Failed to add "${g(e.item)}" to hunt list: ${o instanceof Error?o.message:"Unknown error"}`)}},K=async e=>{if(!e){console.error("Invalid hunt item ID for removal"),c("Cannot remove item: Invalid ID");return}const o=[...r.value];try{t("Removing hunt item with ID:",e);const n=r.value.find($=>$.id===e),i=n?g(n.item):"Item";if(r.value=r.value.filter($=>$.id!==e),_(`Removing "${i}" from hunt list...`),!s.eventId){console.error("Missing event ID for hunt item removal"),c("Cannot remove item: Missing event ID"),r.value=o;return}const{success:a,error:f,data:B}=await ie(e);if(f){console.error("Error removing hunt item:",f),r.value=o,c(`Failed to remove item: ${f.message}`);return}if(!a){console.error("Failed to remove hunt item"),r.value=o,c("Failed to remove item: Unknown error");return}t("Hunt item removed successfully from database"),w(`"${i}" removed from hunt list!`),await b()}catch(n){console.error("Exception during removing hunt item:",n),r.value=o,c(`An error occurred while removing the item: ${n instanceof Error?n.message:"Unknown error"}`),await b()}},L=()=>{t("Setting up real-time subscriptions");const e=X(s.eventId,n=>{t("Received suggestion change:",n.new?.event_id),n.new?.item&&(v.value.push(n.new.item),setTimeout(()=>{const i=v.value.indexOf(n.new.item);i!==-1&&v.value.splice(i,1)},5e3)),n.new&&n.new.id&&n.new.event_id===s.eventId&&(u.value.some(a=>a.id===n.new.id)||(u.value.unshift({...n.new,count:1}),t("Optimistically added new suggestion:",n.new))),setTimeout(()=>{t("Triggering fetchSuggestions due to real-time update (delayed for consistency)"),E()},500)}),o=Y(s.eventId,n=>{t("Received hunt item change"),b()});return{suggestionsCleanup:e,huntItemsCleanup:o}},T=e=>{e?.suggestionsCleanup&&e.suggestionsCleanup(),e?.huntItemsCleanup&&e.huntItemsCleanup()};ae(async()=>{try{t("Component mounted, event ID:",s.eventId),await E(),await b();const e=L();G(()=>{t("Component unmounting, cleaning up subscriptions"),T(e)}),t("Component mounted successfully")}catch(e){console.error("Error during component mounting:",e)}});const U=async({suggestionId:e,type:o})=>{const n=u.value.find(i=>i.id===e);if(n)try{t("Handling image error for suggestion:",n.item);const a=await R([n],"/bognushunter");if(a.error){console.error("Error fetching game data:",a.error);return}const f=a.updatedSuggestions.find(B=>B.id===n.id);f&&f.custom_thumb&&(t("Found game data for",n.item,f),t("Custom thumb saved for",n.item))}catch(i){console.error("Error in handleSuggestionImageError:",i)}},Q=(e,o)=>{const n=e.target;n.src=A(o.item),U({suggestionId:o.id,type:"thumbnail"})},A=e=>`https://via.placeholder.com/300x200/e2e8f0/64748b?text=${encodeURIComponent(g(e))}`;G(()=>{t("Component unmounting")});const D={DEBUG:we,log:t,props:s,supabase:h,suggestions:u,huntList:r,recentlyAddedSuggestions:v,initialHuntListLoaded:I,initialSuggestionsLoaded:S,saveCustomThumb:V,fetchSuggestions:E,fetchHuntList:b,updateHuntItem:W,addToHunt:J,removeFromHunt:K,setupRealTimeSubscriptions:L,cleanupSubscriptions:T,handleSuggestionImageError:U,handleImageError:Q,getPlaceholderImage:A,HuntListItemSimple:ge,SuggestionItem:Ie};return Object.defineProperty(D,"__isScriptSetup",{enumerable:!1,value:!0}),D}}),ye={class:"space-y-3 bg-brown text-gold"},Se={class:"rounded-lg shadow p-3"},Ee={class:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2"},$e={class:"rounded-lg shadow p-3"},He={class:"space-y-2"};function Ce(m,l,t,s,h,u){return p(),y("div",ye,[d("div",Se,[l[0]||(l[0]=d("div",{class:"mb-3"},[d("h2",{class:"text-lg font-semibold text-orange"},"Bognus suggestions for hunt"),d("p",{class:"text-xs mt-1 opacity-75"},"Click on an item to add it to the hunt list")],-1)),d("div",Ee,[(p(!0),y(j,null,O(s.suggestions,r=>(p(),z(s.SuggestionItem,{key:r.id,suggestion:r,"recently-added":s.recentlyAddedSuggestions.includes(r.item),onAddToHunt:s.addToHunt,onImageError:s.handleSuggestionImageError},null,8,["suggestion","recently-added"]))),128))])]),d("div",$e,[l[1]||(l[1]=d("h2",{class:"text-lg font-semibold mb-2 text-orange"},"Hunt List",-1)),d("div",He,[(p(!0),y(j,null,O(s.huntList,r=>(p(),z(s.HuntListItemSimple,{key:r.id,"hunt-item":r,onRemove:s.removeFromHunt},null,8,["hunt-item"]))),128))])])])}const je=F(xe,[["render",Ce]]);export{je as default};
