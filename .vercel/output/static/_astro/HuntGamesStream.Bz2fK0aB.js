import{_ as M,g as E}from"./_plugin-vue_export-helper.DzgpqwbF.js";import{f as W}from"./huntItemService.Itrye26R.js";import{g as q}from"./supabase.CYCWDCT1.js";/* empty css                           */import{d as V,c as o,o as l,e as v,a as s,t as p,F as A,r as O,p as P,n as T,f as g,m as y,g as J,h as k,i as K,l as Q}from"./runtime-core.esm-bundler.6V7JjrVJ.js";const X=V({__name:"HuntGamesStream",props:{eventId:{},refreshInterval:{default:30}},setup(I,{expose:n}){n();const c=I,t=g([]),b=g(!0),h=g(0),a=g(null),w=g(null),S=g(0);let i=null,u=null;const _=async()=>{console.log("Fetching hunt items for eventId:",c.eventId);try{const{huntItems:e,error:r}=await W(c.eventId);if(r){console.error("Error fetching hunt items:",r);return}console.log("Fetched hunt items:",e),t.value=e.filter(m=>m.active)}catch(e){console.error("Exception fetching hunt items:",e)}finally{b.value=!1,await k(),d()}},D=y(()=>t.value.filter(e=>e.bonus).length),F=y(()=>t.value.filter(e=>e.super_bonus).length),L=y(()=>t.value.length),N=e=>{const r=typeof e=="number"?e:0;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(r)},j=e=>e.super_bonus?"super-bonus":e.bonus?"bonus":"regular",R=e=>{const r=e.super_bonus?"Super Bonus":e.bonus?"Bonus":"Regular",m=e.wager?`Wager: ${e.wager}`:"",f=e.result?`Result: ${e.result}`:"";return[e.item,r,m,f].filter(Boolean).join(" â€¢ ")},U=e=>e.custom_thumb?e.custom_thumb.replace("cdn://","https://cdnv1.500.casino/"):"/placeholder-game.png",z=e=>e.length>20?e.substring(0,17)+"...":e,H=e=>{const r=e.target;r.src="/placeholder-game.png"},C=()=>{u=q().channel("hunt-items-stream").on("postgres_changes",{event:"*",schema:"public",table:"hunt_items",filter:`event_id=eq.${c.eventId}`},()=>{_()}).on("postgres_changes",{event:"*",schema:"public",table:"suggestion_events",filter:`id=eq.${c.eventId}`},r=>{const m=r?.new?.starting_balance;typeof m=="number"?h.value=m:E(c.eventId).then(({event:f})=>{f&&typeof f.starting_balance=="number"&&(h.value=f.starting_balance)}).catch(()=>{})}).subscribe()},x=()=>{c.refreshInterval>0&&(i=setInterval(()=>{_()},c.refreshInterval*1e3))},B=()=>{i&&(clearInterval(i),i=null),u&&(u.unsubscribe(),u=null)};J(async()=>{await _();try{const{event:e}=await E(c.eventId);e&&typeof e.starting_balance=="number"&&(h.value=e.starting_balance)}catch(e){console.error("Error fetching event for starting balance",e)}C(),x(),await k(),d(),window.addEventListener("resize",d)}),K(()=>{B(),window.removeEventListener("resize",d)}),Q(t,async()=>{await k(),d()});const d=()=>{const e=a.value?.offsetWidth||0,r=w.value?.scrollWidth||0;S.value=Math.max(0,r-e)},G={props:c,huntItems:t,loading:b,startingBalance:h,tickerContainer:a,tickerTrack:w,scrollDistance:S,get refreshTimer(){return i},set refreshTimer(e){i=e},get realtimeChannel(){return u},set realtimeChannel(e){u=e},fetchHuntItems:_,totalBonus:D,totalSuper:F,totalItems:L,formatCurrency:N,getGameStatusClass:j,getGameTooltip:R,getGameThumbnail:U,formatGameName:z,handleImageError:H,setupRealtimeUpdates:C,setupAutoRefresh:x,cleanup:B,updateScrollDistance:d};return Object.defineProperty(G,"__isScriptSetup",{enumerable:!1,value:!0}),G}}),Y={class:"hunt-games-stream"},Z={key:0,class:"flex justify-center items-center p-2"},$={key:1,class:"stream-stats"},ee={class:"stat"},te={class:"value value-gold"},se={class:"stat"},ne={class:"value value-gold"},ae={class:"stat"},re={class:"value value-bonus"},oe={class:"stat"},le={class:"value value-super"},ce={key:2,ref:"tickerContainer",class:"ticker"},ie=["title"],ue={class:"game-thumb"},de=["src","alt"],me={key:0,class:"completed-overlay"},ge={class:"game-name"},he={class:"status-indicator"},fe={key:0,class:"status-badge super"},pe={key:1,class:"status-badge bonus"},_e={key:2,class:"status-badge regular"},ve={key:3,class:"empty-state"};function be(I,n,c,t,b,h){return l(),o("div",Y,[t.loading?(l(),o("div",Z,n[0]||(n[0]=[s("div",{class:"w-4 h-4 border-2 border-orange border-t-transparent rounded-full animate-spin"},null,-1)]))):v("",!0),t.loading?v("",!0):(l(),o("div",$,[s("div",ee,[n[1]||(n[1]=s("span",{class:"label"},"Starting",-1)),s("span",te,p(t.formatCurrency(t.startingBalance)),1)]),s("div",se,[n[2]||(n[2]=s("span",{class:"label"},"Items",-1)),s("span",ne,p(t.totalItems),1)]),s("div",ae,[n[3]||(n[3]=s("span",{class:"label"},"Bonuses",-1)),s("span",re,p(t.totalBonus),1)]),s("div",oe,[n[4]||(n[4]=s("span",{class:"label"},"Super",-1)),s("span",le,p(t.totalSuper),1)])])),!t.loading&&t.huntItems.length>0?(l(),o("div",ce,[s("div",{ref:"tickerTrack",class:T(["ticker-track",{"no-scroll":t.scrollDistance<=0}]),style:P({"--scroll-distance":t.scrollDistance+"px"})},[(l(!0),o(A,null,O(t.huntItems,a=>(l(),o("div",{key:a.id,class:T(["game-card","ticker-card",t.getGameStatusClass(a)]),title:t.getGameTooltip(a)},[s("div",ue,[s("img",{src:t.getGameThumbnail(a),alt:a.item||"Game",class:"w-full h-full object-cover",onError:t.handleImageError},null,40,de)]),a.completed?(l(),o("div",me,n[5]||(n[5]=[s("svg",{class:"check-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round","aria-hidden":"true"},[s("path",{d:"M20 6L9 17l-5-5",stroke:"#ffffff","stroke-width":"6"}),s("path",{d:"M20 6L9 17l-5-5"})],-1)]))):v("",!0),s("div",ge,p(t.formatGameName(a.item||"Unknown")),1),s("div",he,[a.super_bonus?(l(),o("span",fe,"S")):a.bonus?(l(),o("span",pe,"B")):(l(),o("span",_e,"R"))])],10,ie))),128))],6)],512)):t.loading?v("",!0):(l(),o("div",ve,n[6]||(n[6]=[s("div",{class:"text-gold text-sm opacity-75"},"No games in hunt",-1)])))])}const Ce=M(X,[["render",be],["__scopeId","data-v-b6e6b833"]]);export{Ce as default};
