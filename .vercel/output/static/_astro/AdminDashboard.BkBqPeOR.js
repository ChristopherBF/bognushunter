import{w as z,v as P}from"./runtime-dom.esm-bundler.DkFgPflE.js";import{g as T}from"./supabase.CYCWDCT1.js";import{s as O}from"./realtime.FYg-mwH9.js";import{s as d,a as C,b as R,c as x}from"./toast.nt_L5FyR.js";import{_ as H,f as A,c as q,a as G}from"./_plugin-vue_export-helper.DzgpqwbF.js";import{d as I,c as v,o as c,a as n,t as m,n as W,b as S,e as k,F as y,r as M,w as J,f as p,g as K,h as Q,i as X,j}from"./runtime-core.esm-bundler.6V7JjrVJ.js";/* empty css                       */const Y=I({__name:"EventListItem",props:{event:{type:Object,required:!0}},emits:["close-event","view-suggestions","view-summary","view-hunt-list","share-link"],setup(u,{expose:t}){t();const e=u;function r(h){if(!h)return"";const s=new Date(h);return new Intl.DateTimeFormat("en-US",{year:"numeric",month:"short",day:"numeric"}).format(s)}const l={props:e,formatDate:r};return Object.defineProperty(l,"__isScriptSetup",{enumerable:!1,value:!0}),l}}),Z={class:"p-2 border border-streamer-text-secondary/40 rounded hover:bg-orange-900/40 cursor-pointer shadow"},ee={class:"flex justify-between items-center"},te={class:"flex flex-col flex-grow min-w-0"},ne={class:"flex items-center gap-2 mb-1"},oe={class:"text-gold font-medium text-sm truncate"},se={class:"flex items-center gap-3 text-xs text-streamer-text-secondary"},re={class:"flex items-center gap-1"},ie={class:"flex items-center gap-1"},ae={class:"flex space-x-1 items-center flex-shrink-0"};function le(u,t,e,r,l,h){return c(),v("div",Z,[n("div",ee,[n("div",te,[n("div",ne,[n("span",oe,m(r.formatDate(e.event.date))+" "+m(e.event.name||""),1),n("span",{class:W(["px-1.5 py-0.5 rounded text-xs font-semibold flex-shrink-0",e.event.open?"bg-green-700 text-green-200":"bg-gray-700 text-gray-300"])},m(e.event.open?"Open":"Closed"),3)]),n("div",se,[n("span",null,"Start: $"+m(e.event.starting_balance),1),n("span",null,"Current: $"+m(e.event.current_balance),1),n("span",re,[t[5]||(t[5]=n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)),S(" "+m(e.event.suggestions_count),1)]),n("span",ie,[t[6]||(t[6]=n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)),S(" "+m(e.event.hunt_items_count||0),1)])])]),n("div",ae,[e.event.open?(c(),v("button",{key:0,onClick:t[0]||(t[0]=z(s=>u.$emit("close-event",e.event.id),["stop"])),class:"px-2 py-1 bg-red-700 text-white text-xs rounded hover:bg-red-800 transition-colors",title:"Close"},t[7]||(t[7]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):k("",!0),n("button",{onClick:t[1]||(t[1]=s=>u.$emit("view-suggestions",e.event.id)),title:"Suggestions",class:"px-2 py-1 bg-orange-700 text-gold text-xs rounded hover:bg-orange-800 transition-colors"},t[8]||(t[8]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)])),n("button",{onClick:t[2]||(t[2]=s=>u.$emit("view-summary",e.event.id)),title:"Summary",class:"px-2 py-1 bg-orange-700 text-gold text-xs rounded hover:bg-orange-800 transition-colors"},t[9]||(t[9]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1)])),n("button",{onClick:t[3]||(t[3]=s=>u.$emit("view-hunt-list",e.event.id)),title:"Hunt Details",class:"px-2 py-1 bg-orange-700 text-gold text-xs rounded hover:bg-orange-800 transition-colors"},t[10]||(t[10]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})],-1)])),n("button",{onClick:t[4]||(t[4]=s=>u.$emit("share-link",e.event.id)),title:"Share",class:"px-2 py-1 bg-orange-700 text-gold text-xs rounded hover:bg-orange-800 transition-colors"},t[11]||(t[11]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})],-1)]))])])])}const ue=H(Y,[["render",le]]),de=!0,ce=I({__name:"AdminDashboard",props:{eventId:{},userId:{}},setup(u,{expose:t}){t();const e=(...o)=>console.log("[AdminDashboard]",...o),r=p(null);e("Component script initialization");const l=u;e("Props received:",l);const h=T(),s=p([]),b=p(null),_=p(!1),w=p(1e3),V=async o=>{e("Closing event:",o);const i=s.value.findIndex(a=>a.id===o);if(i===-1){e("Event not found in local events array");return}const g=s.value[i].open;e("Event current open status:",g);try{const{success:a,error:f}=await q(o);a?(s.value[i].open=!1,e("Event closed successfully in database and UI updated"),C("Hunt closed successfully!")):(e("Failed to close event:",f),d(f?.message||"Failed to close hunt"))}catch(a){e("Exception while closing event:",a),d("An unexpected error occurred while closing the hunt")}},L=async o=>{if(e("Create event triggered",o),e("User ID:",l.userId),o&&(o.preventDefault(),o.stopPropagation()),!l.userId){console.error("Error: No user ID provided"),d("Error: User ID is required to create a hunt");return}if(w.value<=0){R("Starting balance must be greater than zero");return}try{e("Creating new hunt using event service with starting balance:",w.value),x("Creating new hunt...");const i=`Hunt ${new Date().toLocaleDateString()}`,{event:g,error:a}=await G(i,l.userId,w.value);if(a){console.error("Error creating event:",a),d(`Failed to create hunt: ${a.message}`);return}if(!g){console.error("Failed to create event: No event data returned"),d("Failed to create hunt: Unknown error");return}e("Event created successfully:",g),C("Hunt created successfully!"),_.value=!1,w.value=1e3,await E()}catch(i){console.error("Error in handleCreateEvent:",i),d("An unexpected error occurred while creating the hunt")}},D=()=>{e("Setting up real-time subscriptions for all events");const o={};return s.value.forEach(i=>{e(`Setting up subscription for event ${i.id}`),o[i.id]=O(i.id,g=>{e(`Received suggestion change for event ${i.id}:`,g);const a=s.value.findIndex(f=>f.id===i.id);a!==-1&&(g.eventType==="INSERT"?(s.value[a].suggestions_count+=1,e(`Incremented count for event ${i.id} to ${s.value[a].suggestions_count}`)):g.eventType==="DELETE"&&(s.value[a].suggestions_count=Math.max(0,s.value[a].suggestions_count-1),e(`Decremented count for event ${i.id} to ${s.value[a].suggestions_count}`)))})}),()=>{e("Cleaning up all subscriptions"),Object.values(o).forEach(i=>i())}};K(async()=>{e("Component mounted");try{await Q(),r.value||console.error("Create event button ref not found"),e("Fetching initial data...");try{e("Calling fetchEvents"),await E(),e("fetchEvents completed successfully"),e("Setting up real-time subscriptions");const o=D();X(()=>{e("Component unmounting, cleaning up subscriptions"),o(),r.value&&(e("Removing event listeners"),r.value.removeEventListener("click",L))})}catch(o){console.error("Error in fetchEvents:",o)}e("Component mounted successfully")}catch(o){console.error("Error during component mounting:",o)}});const $=o=>new Date(o).toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}),F=o=>{e("Navigating to summary page for event:",o),x("Loading summary page...");const i="/bognushunter";window.location.href=`${i}summary/${o}`},N=o=>{e("Navigating to hunt list page for event:",o),x("Loading hunt list page...");const i="/bognushunter";window.location.href=`${i}huntlist/${o}`},U=o=>{e("Sharing suggestion link for event:",o);const a=`${window.location.origin}/bognushuntersuggest/${o}`;navigator.clipboard.writeText(a).then(()=>{e("Link copied to clipboard:",a),b.value=o,C("Link copied to clipboard!"),setTimeout(()=>{b.value===o&&(b.value=null)},3e3)}).catch(f=>{console.error("Error copying link to clipboard:",f),d("Failed to copy link. Please try again.")})},E=async()=>{e("Fetching events");try{if(!l.userId){console.error("Error: No user ID provided for fetching events"),d("Error: User ID is required to fetch hunts");return}const{events:o,error:i}=await A(l.userId);if(i){console.error("Error fetching events:",i),d(`Failed to fetch hunts: ${i.message}`);return}s.value=o,e("Events fetched:",s.value)}catch(o){console.error("Error in fetchEvents:",o),d("Failed to load hunts. Please try again.")}},B={DEBUG:de,log:e,createEventButtonRef:r,props:l,supabase:h,events:s,copiedEventId:b,showCreateEventModal:_,startingBalance:w,handleCloseEvent:V,handleCreateEvent:L,setupRealTimeSubscriptions:D,formatDate:$,viewSummary:F,viewHuntList:N,shareSuggestionLink:U,fetchEvents:E,viewSuggestions:o=>{e("Navigating to suggestions page for event:",o),x("Loading suggestions page...");const i="/bognushunter";window.location.href=`${i}suggestions/${o}`},EventListItem:ue};return Object.defineProperty(B,"__isScriptSetup",{enumerable:!1,value:!0}),B}}),ge={class:"space-y-3"},ve={class:"bg-brown border-2 border-orange rounded-lg shadow-lg p-3"},me={class:"flex justify-between items-center mb-2"},he={class:"space-y-2"},fe={key:1,class:"mt-2 text-sm text-streamer-green-accent flex items-center"},we={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},pe={class:"bg-brown-dark border-2 border-orange rounded-lg shadow-lg p-4 w-80 max-w-sm"},be={class:"mb-3"},xe={class:"flex justify-end space-x-2 mt-4"};function ye(u,t,e,r,l,h){return c(),v(y,null,[n("div",ge,[n("div",ve,[n("div",me,[t[4]||(t[4]=n("h2",{class:"text-lg font-display mb-1 flex-grow text-gold"},"Bognus Hunts",-1)),n("button",{ref:"createEventButtonRef",type:"button",onClick:t[0]||(t[0]=s=>r.showCreateEventModal=!0),class:"px-3 py-1.5 text-sm font-display bg-orange-700 text-gold rounded shadow-md hover:bg-orange-800 transition-colors"}," Create Hunt ",512)]),n("div",he,[(c(!0),v(y,null,M(r.events.filter(s=>s.open),s=>(c(),j(r.EventListItem,{key:s.id,event:s,onViewSuggestions:r.viewSuggestions,onViewSummary:r.viewSummary,onViewHuntList:r.viewHuntList,onShareLink:r.shareSuggestionLink,onCloseEvent:r.handleCloseEvent},null,8,["event"]))),128)),r.events.some(s=>!s.open)?(c(),v(y,{key:0},[t[5]||(t[5]=n("hr",{class:"my-3 border-orange/40"},null,-1)),t[6]||(t[6]=n("h3",{class:"text-base text-gold mb-1"},"Closed Hunts",-1)),(c(!0),v(y,null,M(r.events.filter(s=>!s.open),s=>(c(),j(r.EventListItem,{key:s.id,event:s,onViewSuggestions:r.viewSuggestions,onViewSummary:r.viewSummary,onViewHuntList:r.viewHuntList,onShareLink:r.shareSuggestionLink,onCloseEvent:r.handleCloseEvent},null,8,["event"]))),128))],64)):k("",!0),r.copiedEventId?(c(),v("div",fe,t[7]||(t[7]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),S(" Link copied to clipboard! ",-1)]))):k("",!0)])])]),r.showCreateEventModal?(c(),v("div",we,[n("div",pe,[t[9]||(t[9]=n("h3",{class:"text-lg font-display text-gold mb-3"},"Create New Hunt",-1)),n("div",be,[t[8]||(t[8]=n("label",{for:"startingBalance",class:"block text-sm font-medium text-gold mb-1"},"Starting Balance",-1)),J(n("input",{id:"startingBalance","onUpdate:modelValue":t[1]||(t[1]=s=>r.startingBalance=s),type:"number",min:"0",step:"1",class:"w-full px-2 py-1.5 text-sm border border-orange rounded bg-brown text-gold focus:outline-none focus:ring-1 focus:ring-orange",placeholder:"Enter starting balance"},null,512),[[P,r.startingBalance]])]),n("div",xe,[n("button",{onClick:t[2]||(t[2]=s=>r.showCreateEventModal=!1),class:"px-3 py-1.5 text-sm bg-gray-700 text-gray-200 rounded hover:bg-gray-600 transition-colors"}," Cancel "),n("button",{onClick:t[3]||(t[3]=s=>r.handleCreateEvent()),class:"px-3 py-1.5 text-sm bg-orange-700 text-gold rounded hover:bg-orange-600 transition-colors"}," Create Hunt ")])])])):k("",!0)],64)}const Me=H(ce,[["render",ye]]);export{Me as default};
