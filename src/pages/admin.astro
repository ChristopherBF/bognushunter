---
console.log('[admin.astro] Page processing started on server...');
export const prerender = false;
import Layout from '../layouts/Layout.astro';
import AdminDashboard from '../components/Admin/AdminDashboard.vue';
import { getCurrentUser } from '../lib/auth';
import { requireAuth } from '../lib/auth';

// Get the user using direct Supabase authentication
const user = await getCurrentUser(Astro.cookies);
const userLog = await requireAuth({ cookies: Astro.cookies, redirect: Astro.redirect });
console.log('[admin.astro] User from Supabase:', user ? 'authenticated' : 'not authenticated');
console.log('[admin.astro] User from requireAuth:', userLog ? 'authenticated' : 'not authenticated');

// Admin-specific check - redirect if not authenticated
if (!user) {
  return Astro.redirect('/bognushunter/login');
}

// Default event ID
const defaultEventId = "123e4567-e89b-12d3-a456-426614174000";
const eventId = Astro.props.eventId || defaultEventId;
console.log('[admin.astro] Event ID:', Astro.props);
---

<Layout title="Admin Dashboard" isAdmin>
  <AdminDashboard client:load eventId={eventId} userId={user.id} />
</Layout>