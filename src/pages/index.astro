---
export const prerender = false;
import Layout from '../layouts/Layout.astro';
import SuggestionForm from '../components/User/SuggestionForm.vue';
import { getCurrentUser } from '../lib/auth.ts';

// Resolve base path for correct redirects under GitHub Pages
const basePath = import.meta.env.BASE_URL || '/';

// Get the user using direct Supabase authentication
const user = await getCurrentUser(Astro.cookies);
console.log('[index.astro] User from Supabase:', user ? 'authenticated' : 'not authenticated');

// If no user is authenticated, redirect to login
if (!user) {
  return Astro.redirect(`${basePath}login`);
}

// Default event ID
const defaultEventId = "123e4567-e89b-12d3-a456-426614174000";
const eventId = defaultEventId;
console.log('[index.astro] Event ID (default used on page):', eventId);
---

<Layout title="Bognus Hunter Dashboard">
  <SuggestionForm eventId={eventId} userId={user.id} client:load />
</Layout>